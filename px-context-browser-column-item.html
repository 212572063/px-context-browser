<link rel="import" href="../polymer/polymer.html"/>

<dom-module id="px-context-browser-column-item">
  <link rel="import" type="css" href="css/px-context-browser.css" />
  <template>
    <li on-click="itemClickHandler" id$="[[itemId]]" class$="{{isItemSelected}}">
      <span class="flex__item item-label">{{getItemLabel(item)}}</span>
      <button class$="[[itemOpenerClass]]" on-click="openClickHandler" key$="[[itemId]]">
        Open
      </button>
      <template is="dom-if" if="{{_hasChildren}}">
        <span class="chevron"><i class="fa fa-angle-right"></i></span>
      </template>
    </li>
  </template>
</dom-module>

<script>
  Polymer({
    is: 'px-context-browser-column-item',
    properties: {
      /**
       * Item data passed from parent menu
       *
       * @type {Object}
       * @default null
       */
      columnItem: {
        type: Object,
        value: null
      },
      /**
       * show chevron
       * @type {Boolean}
       * @default false
       *
       */
      showChevron: {
        type: Boolean,
        value: false,
        reflectToAttribute: true
      },

      testValue: 'test',

      fieldKeys: {
        type: Object,
        value: function() {
          return {
            children: "data",
            id: "id",
            label: "name"
          }
        }
      },

      itemOpenerClass: {
        type: String,
        value: 'temp-item-opener-class',
        computed: '_computeItemOpenerClass(columnItem)'
      },

      itemId: {
        type: String,
        computed: '_computeItemId(columnItem, fieldKeys)'
      },

      isItemSelected: {
        type: Boolean,
        value: false,
        computed: '_computeIsItemSelected(columnItem)'
      },

      _hasChildren: {
        type: Boolean,
        value: false,
        computed: '_computeHasChildren(columnItem)'
      },

      _baseClassNames: {
        type: String,
        value: 'opener btn btn--small btn--tertiary '
      }

    },

    ready: function() {
      
    },

    _computeItemOpenerClass: function(item) {
      if(item !== null) {
        var openableClassName = item.isOpenable ? "openable" : "unopenable";
        return this._baseClassNames + openableClassName;
      }
    },

    menu: null,

    _computeItemId: function(item) {
      return item ? item[this.fieldKeys['id']] : null;
    },

    _computeIsItemSelected: function(item) {
      var base = "flex flex--middle selectable-item";
      // console.log('item',this.item);
      return item.inSelectedPath ? base += " selected" : base;
    },

    _computeHasChildren: function(item) {

    },

    _openClickHandler: function() {

    },

    /**
     * this method checks whether the attribute hasChildren has been set to true, and if it has,
     * whether the item has a property by the name of children or hasChildren
     * @param {object} item
     * @private
     */
    _hasChildren: function() {
      return (this.showChevron) ? (this.item.hasChildren || this.item.children) : false;
    },

    /**
     * @param {Object} item
     * @return {String} Display label for given item
     * @private
     */
    getItemLabel: function(item) {
      return item ? item[this.parent.labelField] || '' : '';
    },

    /**
     * @param {Object} item
     * @return {String} Id for given item
     * @private
     */
    getItemId: function(item) {

    },

    /**
     * @param {Object} item
     * @return {String} CSS class for item opener
     * @private
     */
    getItemOpenerClass: function() {

    },

    /**
     * @param {String} base
     * @return {String} CSS class for item
     * @private
     */
    isItemSelected: function(selectedItem) {

    },

    /**
     * Observer on LI, and whether they should show up. replaces polymer hidden, which seems to be shaky with IE.
     * if base_classes is passed in, it is returned with the appropriate response.
     *
     * @param {string} item
     * param {string} base_classes
     * @private
     */
    isItemHidden: function(item, base_classes) {
      if (base_classes  !== undefined) {
        return base_classes += (!item) ? " visuallyhidden" : '';
      } else {
        return (!item) ? "visuallyhidden" : '';
      }
    }
  });
</script>
