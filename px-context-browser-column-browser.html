<link rel="import" href="../polymer/polymer.html"/>
<link rel="import" href="px-context-browser-column.html"/>

<dom-module id="px-context-browser-column-browser">
  <link rel="import" type="css" href="css/px-context-browser.css" />
  <script src="../lodash/lodash.js"></script>
  <template>
    <div class="flex flex--col column-browser">
      <px-spinner id="spinner" finished></px-spinner>
      <div class="flex">
        <template is="dom-repeat" id="levels" items="[[columns]]">
          <px-context-browser-column
            column-data="[[item]]"
            field-keys="[[fieldKeys]]"
            context="[[context]]"></px-context-browser-column>
        </template>
      </div>
      <div class="ruler">
      </div>
      <div class="overlay"></div>
    </div>
  </template>
</dom-module>

<script>
  Polymer({
    is: 'px-context-browser-column-browser',
    properties: {
      /**
       * Hierarchy of items down to currently selected item. Set here as a property to expose it to the template, but managed internally. Do not set this.
       *
       * @type {Array}
       * @default []
       * @private
       */
      parentNodes: {
        type: Array,
        value: function() {return [];} //this is Polmer's way of defining an empty array in properties
      },
      context: {
        type: Object,
        value: function() { return {}; },
        observer: '_contextChanged'
      },
      columns: {
        type: Array,
        value: function() { return []; }
      },
      fieldKeys: {
        type: Object,
        value: null
      }
    },

    observers: [
      '_contextChanged(context.random)'
    ],

    _contextChanged: function() {
      if(!_.isEmpty(this.context)) {
        var children = this.context[this.fieldKeys['children']] || [];
        if(_.isEmpty(this.columns)) {
          // add the first column
          this.push('columns', { children });
        } else {
          // update existing columns
          console.log('updating existing columns.0')
          this.set('columns.0', { children });
        }

      } else {
        this.columns = [];
        // merge with existing?
      }
    },

    showOverlay: function() {
      this.$$('.overlay').style.display = 'block';
    },

    hideOverlay: function() {
      this.$$('.overlay').style.display = 'none';
    },

    showSpinner: function() {
      this.$.spinner.set('finished', false);
    },

    hideSpinner: function() {
      this.$.spinner.set('finished', true);
    }

  });
</script>
